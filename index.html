<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForestApp - Rilevamento Forestale</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#16a34a">
</head>
<body>
    <!-- Project Selection Screen -->
    <div id="project-screen" class="screen">
        <div class="project-container">
            <header class="project-header">
                <h1>üå≤ ForestApp</h1>
                <p>Rilevamento Forestale Professionale</p>
            </header>

            <div class="project-content">
                <div class="card">
                    <h2>Gestione Progetti</h2>
                    
                    <div class="project-actions">
                        <button id="new-project-btn" class="btn-primary">
                            ‚ûï Nuovo Progetto
                        </button>
                        
                        <div class="project-form" id="new-project-form" style="display: none;">
                            <div class="form-group">
                                <label>Nome Progetto:</label>
                                <input type="text" id="project-name-input" placeholder="es. Bosco di Pino 2024">
                            </div>
                            <div class="form-group">
                                <label>Area Totale (ha):</label>
                                <input type="number" id="project-area-input" value="30" min="0.1" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label>Specie da Rilevare:</label>
                                <p class="form-help">Aggiungi le specie che troverai nel tuo rilevamento:</p>
                                <div id="project-species-list" class="species-list">
                                    <p class="empty">Nessuna specie aggiunta. Inizia aggiungendo le prime specie.</p>
                                </div>
                                
                                <div class="add-species-section">
                                    <div class="species-input-form" id="species-input-form">
                                        <div class="form-row">
                                            <input type="text" id="new-species-name" placeholder="Nome specie (es. Pino domestico, Quercia, etc.)">
                                            <div class="emoji-selector">
                                                <button type="button" id="emoji-btn" class="emoji-btn">üå≤</button>
                                                <div id="emoji-dropdown" class="emoji-dropdown" style="display: none;">
                                                    <!-- Emoji options will be populated by JavaScript -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <label>Fattore di Forma:</label>
                                            <input type="number" id="new-species-factor" value="0.5" min="0.1" max="1.0" step="0.01">
                                            <label>Altezza Media (m):</label>
                                            <input type="number" id="new-species-height" value="15" min="0.5" max="50" step="0.1">
                                            <button type="button" id="add-species-to-project-btn" class="btn-sm">Aggiungi Specie</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-buttons">
                                <button id="create-project-btn" class="btn">Crea</button>
                                <button id="cancel-project-btn" class="btn-secondary">Annulla</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" id="existing-projects-card">
                    <h3>Progetti Esistenti</h3>
                    <div id="projects-list" class="projects-list">
                        <p class="empty">Nessun progetto salvato</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üå≤ ForestApp</h1>
                <div class="status">
                    <span id="status">Online</span>
                    <span id="project-name">Nuovo Progetto</span>
                </div>
            </div>
            
            <!-- Stats Bar -->
            <div class="stats">
                <div class="stat">
                    <span class="value" id="sample-count">0</span>
                    <span class="label">Saggio</span>
                </div>
                <div class="stat">
                    <span class="value" id="inventory-count">0</span>
                    <span class="label">Piedilista</span>
                </div>
                <div class="stat">
                    <span class="value" id="volume-total">0.0</span>
                    <span class="label">m¬≥</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-tab="sample">üìè Aree Saggio</button>
            <button class="nav-btn" data-tab="inventory">üìä Piedilista</button>
            <button class="nav-btn" data-tab="results">üìà Risultati</button>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Sample Area Tab -->
            <section id="sample-tab" class="tab active">
                <div class="card">
                    <h2>Aree di Saggio</h2>
                    
                    <!-- Area Selector -->
                    <div class="form-group">
                        <label>Area di Saggio:</label>
                        <select id="area-selector">
                            <option value="1">Area 1</option>
                            <option value="2">Area 2</option>
                            <option value="3">Area 3</option>
                            <option value="4">Area 4</option>
                            <option value="5">Area 5</option>
                        </select>
                    </div>

                    <!-- Species Selector -->
                    <div class="form-group">
                        <label>Specie:</label>
                        <div id="sample-species-buttons" class="species-buttons">
                            <!-- Species buttons will be generated dynamically -->
                        </div>
                        <div class="species-management-buttons">
                            <button class="add-species-btn" onclick="showAddSpeciesModal('sample')">
                                + Aggiungi Nuova Specie
                            </button>
                            <button class="manage-species-btn" onclick="showSpeciesManagementModal('delete')">
                                üóëÔ∏è Elimina Specie
                            </button>
                            <button class="manage-species-btn" onclick="showSpeciesManagementModal('modify')">
                                ‚úèÔ∏è Modifica Specie
                            </button>
                        </div>
                    </div>

                    <!-- Diameter Classes -->
                    <div class="form-group">
                        <label>Diametro (cm):</label>
                        <div class="diameter-buttons">
                            <button class="diameter-btn" data-diameter="5" disabled>5cm</button>
                            <button class="diameter-btn" data-diameter="10" disabled>10cm</button>
                            <button class="diameter-btn" data-diameter="15" disabled>15cm</button>
                            <button class="diameter-btn" data-diameter="20" disabled>20cm</button>
                            <button class="diameter-btn" data-diameter="25" disabled>25cm</button>
                            <button class="diameter-btn" data-diameter="30" disabled>30cm</button>
                            <button class="diameter-btn" data-diameter="35" disabled>35cm</button>
                            <button class="diameter-btn" data-diameter="40" disabled>40cm</button>
                            <button class="diameter-btn" data-diameter="45" disabled>45cm</button>
                            <button class="diameter-btn" data-diameter="50" disabled>50cm</button>
                            <button class="diameter-btn" data-diameter="55" disabled>55cm</button>
                            <button class="diameter-btn" data-diameter="60" disabled>60cm</button>
                        </div>
                        <button class="custom-diameter-btn" id="custom-diameter-sample-btn" onclick="showCustomDiameterModal('sample')" disabled>
                            üìè Inserisci altro diametro
                        </button>
                    </div>

                    <!-- Height Input -->
                    <div class="form-group" id="height-input" style="display: none;">
                        <label>Altezza (m):</label>
                        <div class="height-buttons">
                            <button class="height-btn" data-height="3">3m</button>
                            <button class="height-btn" data-height="5">5m</button>
                            <button class="height-btn" data-height="7">7m</button>
                            <button class="height-btn" data-height="9">9m</button>
                            <button class="height-btn" data-height="11">11m</button>
                            <button class="height-btn" data-height="13.5">13.5m</button>
                            <button class="height-btn" data-height="16.5">16.5m</button>
                            <button class="height-btn" data-height="20">20m</button>
                            <button class="height-btn" data-height="25">25m</button>
                        </div>
                    </div>

                    <div id="sample-status" class="status-message"></div>
                </div>

                <!-- Recent Sample Trees -->
                <div class="card">
                    <h3>Piante Saggio Recenti</h3>
                    <div id="sample-list" class="tree-list">
                        <p class="empty">Nessuna pianta di saggio ancora</p>
                    </div>
                </div>
            </section>

            <!-- Inventory Tab -->
            <section id="inventory-tab" class="tab">
                <div class="card">
                    <h2>Piedilista Forestale</h2>
                    
                    <!-- Area Input -->
                    <div class="form-group">
                        <label>Area Totale (ha):</label>
                        <input type="number" id="total-area" value="30" min="0.1" step="0.1">
                    </div>

                    <!-- Species Selector -->
                    <div class="form-group">
                        <label>Specie:</label>
                        <div id="inventory-species-buttons" class="species-buttons">
                            <!-- Species buttons will be generated dynamically -->
                        </div>
                        <div class="species-management-buttons">
                            <button class="add-species-btn" onclick="showAddSpeciesModal('inventory')">
                                + Aggiungi Nuova Specie
                            </button>
                            <button class="manage-species-btn" onclick="showSpeciesManagementModal('delete')">
                                üóëÔ∏è Elimina Specie
                            </button>
                            <button class="manage-species-btn" onclick="showSpeciesManagementModal('modify')">
                                ‚úèÔ∏è Modifica Specie
                            </button>
                        </div>
                    </div>

                    <!-- Diameter Classes -->
                    <div class="form-group">
                        <label>Diametro (cm):</label>
                        <div class="diameter-buttons">
                            <button class="diameter-btn inventory" data-diameter="5" disabled>5cm</button>
                            <button class="diameter-btn inventory" data-diameter="10" disabled>10cm</button>
                            <button class="diameter-btn inventory" data-diameter="15" disabled>15cm</button>
                            <button class="diameter-btn inventory" data-diameter="20" disabled>20cm</button>
                            <button class="diameter-btn inventory" data-diameter="25" disabled>25cm</button>
                            <button class="diameter-btn inventory" data-diameter="30" disabled>30cm</button>
                            <button class="diameter-btn inventory" data-diameter="35" disabled>35cm</button>
                            <button class="diameter-btn inventory" data-diameter="40" disabled>40cm</button>
                            <button class="diameter-btn inventory" data-diameter="45" disabled>45cm</button>
                            <button class="diameter-btn inventory" data-diameter="50" disabled>50cm</button>
                            <button class="diameter-btn inventory" data-diameter="55" disabled>55cm</button>
                            <button class="diameter-btn inventory" data-diameter="60" disabled>60cm</button>
                        </div>
                        <button class="custom-diameter-btn" id="custom-diameter-inventory-btn" onclick="showCustomDiameterModal('inventory')" disabled>
                            üìè Inserisci altro diametro
                        </button>
                    </div>

                    <button id="clear-inventory" class="btn-danger">üóëÔ∏è Pulisci Piedilista</button>
                </div>

                <!-- Recent Inventory Trees -->
                <div class="card">
                    <h3>Piedilista Recente</h3>
                    <div id="inventory-list" class="tree-list">
                        <p class="empty">Nessuna pianta in piedilista</p>
                    </div>
                </div>
            </section>

            <!-- Results Tab -->
            <section id="results-tab" class="tab">
                <div class="card">
                    <h2>Gestione Progetti</h2>
                    <div class="project-actions">
                        <button id="new-project" class="btn">‚ûï Nuovo Progetto</button>
                        <button id="export-data" class="btn">üìÑ Esporta Dati</button>
                        <button id="clear-all" class="btn-danger">üóëÔ∏è Pulisci Tutto</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Statistiche</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-trees">0</div>
                            <div class="stat-label">Piante Totali</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="trees-per-ha">0</div>
                            <div class="stat-label">Piante/Ha</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="basal-area">0.00</div>
                            <div class="stat-label">Area Basim. m¬≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="volume-per-ha">0.0</div>
                            <div class="stat-label">Volume m¬≥/ha</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Altezze Medie per Specie</h3>
                    <div id="height-averages" class="height-list">
                        <p class="empty">Nessuna altezza rilevata</p>
                    </div>
                </div>

                <div class="card">
                    <h3>Analisi per Specie</h3>
                    <div id="species-analysis" class="species-list">
                        <p class="empty">Nessun dato da analizzare</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/database.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Add Species Modal -->
    <div id="species-modal" class="species-modal" style="display: none;">
        <div class="species-modal-content">
            <h3>Aggiungi Nuova Specie</h3>
            <div class="species-form">
                <div class="form-group">
                    <label>Nome Specie:</label>
                    <input type="text" id="modal-species-name" placeholder="es. Quercia, Faggio, etc.">
                </div>
                <div class="form-group">
                    <label>Icona:</label>
                    <div class="emoji-selector">
                        <button type="button" id="modal-emoji-btn" class="emoji-btn">üå≤</button>
                        <div id="modal-emoji-dropdown" class="emoji-dropdown" style="display: none;">
                            <!-- Emoji options will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Fattore di Forma:</label>
                    <input type="number" id="modal-species-factor" value="0.5" min="0.1" max="1.0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Altezza Media per Piedilista (m):</label>
                    <input type="number" id="modal-species-height" value="15" min="0.5" max="50" step="0.1" placeholder="es. 15.5">
                    <p class="form-help">Altezza che verr√† usata automaticamente per i calcoli nel Piedilista</p>
                </div>
            </div>
            <div class="species-form-buttons">
                <button id="save-species-btn" class="btn">Aggiungi</button>
                <button id="cancel-species-btn" class="btn-secondary">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Species Management Modal -->
    <div id="species-management-modal" class="species-modal" style="display: none;">
        <div class="species-modal-content">
            <h3 id="management-modal-title">Gestione Specie</h3>
            <div id="species-management-content">
                <div id="species-list-container" class="species-management-list">
                    <!-- Species list will be populated by JavaScript -->
                </div>
            </div>
            <div class="species-form-buttons">
                <button id="cancel-management-btn" class="btn-secondary">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- Modify Species Modal -->
    <div id="modify-species-modal" class="species-modal" style="display: none;">
        <div class="species-modal-content">
            <h3>Modifica Specie</h3>
            <div class="species-form">
                <div class="form-group">
                    <label>Nome Specie:</label>
                    <input type="text" id="modify-species-name" placeholder="es. Quercia, Faggio, etc.">
                </div>
                <div class="form-group">
                    <label>Icona:</label>
                    <div class="emoji-selector">
                        <button type="button" id="modify-emoji-btn" class="emoji-btn">üå≤</button>
                        <div id="modify-emoji-dropdown" class="emoji-dropdown" style="display: none;">
                            <!-- Emoji options will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Fattore di Forma:</label>
                    <input type="number" id="modify-species-factor" value="0.5" min="0.1" max="1.0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Altezza Media per Piedilista (m):</label>
                    <input type="number" id="modify-species-height" value="15" min="0.5" max="50" step="0.1" placeholder="es. 15.5">
                    <p class="form-help">Altezza che verr√† usata automaticamente per i calcoli nel Piedilista</p>
                </div>
            </div>
            <div class="species-form-buttons">
                <button id="save-modify-species-btn" class="btn">Salva Modifiche</button>
                <button id="cancel-modify-species-btn" class="btn-secondary">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Custom Diameter Modal -->
    <div id="custom-diameter-modal" class="species-modal" style="display: none;">
        <div class="species-modal-content">
            <h3>Inserisci Diametro Personalizzato</h3>
            <div class="species-form">
                <div class="form-group">
                    <label>Diametro (cm):</label>
                    <input type="number" id="custom-diameter-input" min="1" max="200" step="0.1" placeholder="es. 75.5">
                </div>
                <p class="form-help">Inserisci il diametro in centimetri (maggiore di 60cm)</p>
            </div>
            <div class="species-form-buttons">
                <button id="save-custom-diameter-btn" class="btn">Conferma</button>
                <button id="cancel-custom-diameter-btn" class="btn-secondary">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications"></div>
</body>
</html>